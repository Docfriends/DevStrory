---
layout: post
title: "상속과 합성 이야기"
description: "상속과 합성에 대해 알아봅니다."
date: 2023-12-01
tags: [OOP]
writer: syh8088
category: OOP
comments: true
share: true
---

# 상속(Inheritance) 과 합성(Compositio) 이야기

인싸이트 플러스 결제 관련 개발을 하고 있었을때 입니다. 여기서 미납금 결제 개발을 하고 있었는데요.

우선 상속과 합성 이야기를 하기 전 간단하게 인싸이트 플러스 결제 시스템에 대해 이야기 먼저 하고자 합니다.


인싸이트 플러스에서 결제 카테고리가 크게 2가지 있습니다.

$이미지6

1. 이용권 결제
2. 상품 결제

$이미지3

예를들어 A 사용자가 2023년 10월 15일에 초기 이용권 결제를 성공했다고 합시다. 결제 성공 동시에 고객이 입력했던 결제 카드 정보와 결제 수단이 등록 하게 됩니다.
등록된 결제 수단 데이터를 이용해 다음달에 자동 결제가 이루어집니다.

한달이 지난 시점에 2023년 11월 15일에 자동결제가 되는데 이때 앞서 이야기 드린 것 처럼 '이용권 결제' 그리고 '상품 결제' 를 하는데요. 

1. 다음달에 이용할수 있도록 2023-11-15 ~ 2023-12-14 에 대한 이용권 결제
2. 2023-10-15 ~ 2023-11-14 까지 사용한 상품(문자 및 지식인) 결제

이렇게 자동 결제가 이루어집니다.

$이미지5

두가지 중 한가지라도 결제가 실패가 될 경우 미납금 처리 및 고객에게 미납금 결제 할수 있도록 상태 변경 하는데요.
여기서 우리가 이제 본격적으로 설명하고자 하는 고객이 미납금 결제시에 대한 이야기가 시작 됩니다.

만약 고객이 미납금이 모두 결제하지 않으면 다음달 자동 결제는 이루어지지 않으며 그에 대한 이용권 자격도 박탈 하게 됩니다.

모든 미납금 결제 성공시 상황에 따라 이용권 자격 승인 및 다음달 자동 결제 하도록 상태 변경 하게 됩니다.

여기서 미납금 결제시 작동되는 각각의 이벤트을 알아봅시다.


$이미지7

1. 주문건 상태 변경
   - 해당 주문건에 상태 변경 작업이 이루어 집니다.

2. 센터 서비스 타입 변경
    - 미납금이 모두 결제가 되면 해당 센터는 '프리미엄' 혹은 '스탠다드' 서비스 타입으로 변경 하게 됩니다.
3. 이용권 다음달 자동 결제 추가
   - 미납금 모두 결제가 되면 조건에 따라 다음달에 이용권 자동 예약 결제 신청 하게 됩니다.
4. 상품 다음달 자동 결제 추가
   - 미납금 모두 결제가 되면 조건에 따라 다음달에 상품 자동 예약 결제 신청 하게 됩니다.
5. 이용권 미납금 상태 변경
   - 해당 이용권 미납금 결제 완료시 결제 완료에 대한 상태값 변경 
6. 상품 미납금 상태 변경
   - 해당 상품 미납금 결제 완료시 결제 완료에 대한 상태값 변경

크게 6가지 작업이 이루어지는데 문제는 여기서 상황에 따라 모두 6가지가 작동 될수도 있고 일부분만 작동 된다는 것 입니다.


1 CASE 



 